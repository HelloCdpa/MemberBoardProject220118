<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>상세조회</title>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
</head>
<body>

<input type="hidden" id="boardId" th:value="${board.boardId}">
<input type="hidden" id="memberId" th:value="${board.memberId}">
<p th:text="${board.boardWriter}"></p>
<p th:text="${board.boardPassword}"></p>
<p th:text="${board.boardTitle}"></p>
<p th:text="${board.boardContents}"></p>
<p th:text="${board.boardFileName}"></p>
<p th:text="${board.createBoardDate}"></p>

<div id="comment-write">
    <input type="text" id="commentWriter" th:value="${session['loginEmail']}"><br>
    <input type="text" id="commentContents" placeholder="내용"><br>
    <button id="comment-write-btn">댓글등록</button>
</div>
<div id="comment-list">
    <table class="table">

    </table>
</div>
</body>
<script>
    $("#comment-write-btn").click(function (){
        console.log("댓글작성클릭");
        const commentWriter = $("#commentWriter").val();
        const commentContents = $("#commentContents").val();
        const boardId = $("#boardId").val();
        const memberId = $("#memberId").val();
        console.log(commentWriter + commentContents + boardId);
        $.ajax({
            type:'post',
            url:'/comment/save',
            data:{
                'commentWriter' : commentWriter,
                'commentContents': commentContents,
                'boardId':boardId,
                'memberId':memberId

            },
            dataType : 'json',
            success: function (result){
                console.log(result);
                let output = "<table class='table'>";
                output += "<tr><th>댓글번호</th>";
                output += "<th>작성자</th>";
                output += "<th>내용</th>";
                output += "<th>작성시간</th></tr>";
                for(let i in result){
                    output += "<tr>";
                    output += "<td>"+result[i].commentId+"</td>";
                    output += "<td>"+result[i].commentWriter+"</td>";
                    output += "<td>"+result[i].commentContents+"</td>";
                    output += "<td>"+result[i].commentCreateDate+"</td>";
                    output += "</tr>";
                }
                output += "</table>";
                // id가 comment-list인 div에 출력
                document.getElementById('comment-list').innerHTML = output;
                //작성내용 비우기
                document.getElementById('commentContents').value='';
            },
            error:function (){
                alert('ajax 실패');
            }
        });
    });


</script>
</html>